<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Rendiconto Parrocchiale</title>
    <style>
        @page {
            size: A4;
            margin: 1.5cm 2cm;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            font-size: 9pt;
            line-height: 1.3;
            color: #2c3e50;
        }
        
        /* ========== PAGINA 1 - FRONTESPIZIO ========== */
        .page-frontespizio {
            page-break-after: always;
        }
        
        .header-diocesi {
            text-align: center;
            padding: 0.8cm 0 0.5cm 0;
            border-bottom: 3px solid #2c3e50;
            margin-bottom: 0.8cm;
        }
        
        .header-diocesi h1 {
            font-size: 16pt;
            font-weight: 700;
            color: #2c3e50;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 0.3cm;
        }
        
        .header-diocesi h2 {
            font-size: 14pt;
            font-weight: 400;
            color: #7f8c8d;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .anno-box {
            text-align: center;
            font-size: 18pt;
            font-weight: 700;
            color: white;
            background: #34495e;
            padding: 0.4cm;
            margin: 0.8cm 0;
        }
        
        .info-section {
            margin: 0.6cm 0;
        }
        
        .info-section h3 {
            font-size: 11pt;
            font-weight: 700;
            color: #2c3e50;
            text-transform: uppercase;
            border-bottom: 2px solid #3498db;
            padding-bottom: 0.2cm;
            margin-bottom: 0.4cm;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.3cm 0.6cm;
        }
        
        .info-row {
            display: flex;
            padding: 0.15cm 0;
        }
        
        .info-label {
            font-weight: 600;
            min-width: 5cm;
            color: #34495e;
        }
        
        .info-value {
            flex: 1;
            border-bottom: 1px dotted #bdc3c7;
            padding-left: 0.3cm;
        }
        
        .nota-box {
            margin-top: 1cm;
            padding: 0.4cm;
            background: #ecf0f1;
            border-left: 4px solid #e74c3c;
            font-size: 8pt;
            line-height: 1.4;
        }
        
        /* ========== MOVIMENTI ========== */
        .page-movimenti {
            page-break-after: always;
        }
        
        h2 {
            font-size: 12pt;
            font-weight: 700;
            color: #2c3e50;
            text-transform: uppercase;
            border-bottom: 2px solid #3498db;
            padding: 0.3cm 0 0.2cm 0;
            margin: 0.5cm 0 0.3cm 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 8pt;
            margin: 0.3cm 0;
        }
        
        table thead {
            background: #34495e;
            color: white;
        }
        
        table th {
            padding: 0.25cm 0.2cm;
            text-align: left;
            font-weight: 600;
            font-size: 8pt;
            text-transform: uppercase;
        }
        
        table tbody tr {
            border-bottom: 1px solid #ecf0f1;
        }
        
        table tbody tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        table td {
            padding: 0.15cm 0.2cm;
            vertical-align: top;
        }
        
        .td-data {
            width: 2cm;
            text-align: center;
            font-size: 7pt;
            color: #7f8c8d;
        }
        
        .td-importo {
            width: 2.2cm;
            text-align: right;
            font-weight: 600;
            font-family: 'Courier New', monospace;
            font-size: 8pt;
        }
        
        .entrata {
            color: #27ae60;
        }
        
        .uscita {
            color: #e74c3c;
        }
        
        /* ========== ULTIMA PAGINA - RIEPILOGO ========== */
        .page-riepilogo {
            padding-top: 0.5cm;
        }
        
        .riepilogo-header {
            font-size: 14pt;
            font-weight: 700;
            text-align: center;
            color: white;
            background: #34495e;
            padding: 0.4cm;
            margin-bottom: 0.6cm;
            text-transform: uppercase;
        }
        
        .riepilogo-orizzontale {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.4cm;
            margin-bottom: 0.8cm;
        }
        
        .riepilogo-box {
            padding: 0.4cm;
            text-align: center;
            border: 2px solid #34495e;
        }
        
        .riepilogo-box.entrate {
            background: #d4edda;
            border-color: #27ae60;
        }
        
        .riepilogo-box.uscite {
            background: #f8d7da;
            border-color: #e74c3c;
        }
        
        .riepilogo-box.saldo {
            background: #d1ecf1;
            border-color: #3498db;
        }
        
        .riepilogo-label {
            font-size: 9pt;
            font-weight: 600;
            text-transform: uppercase;
            color: #2c3e50;
            margin-bottom: 0.2cm;
        }
        
        .riepilogo-value {
            font-size: 16pt;
            font-weight: 700;
            font-family: 'Courier New', monospace;
            color: #2c3e50;
        }
        
        .situazione-title {
            font-size: 11pt;
            font-weight: 700;
            color: #2c3e50;
            text-transform: uppercase;
            border-bottom: 2px solid #3498db;
            padding-bottom: 0.2cm;
            margin: 0.6cm 0 0.4cm 0;
        }
        
        .situazione-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.6cm;
            margin-bottom: 0.6cm;
        }
        
        .situazione-col {
            border: 2px solid #34495e;
            padding: 0.4cm;
        }
        
        .col-title {
            font-size: 10pt;
            font-weight: 700;
            color: white;
            background: #34495e;
            padding: 0.2cm;
            margin: -0.4cm -0.4cm 0.3cm -0.4cm;
            text-transform: uppercase;
            text-align: center;
        }
        
        .conto-row {
            display: flex;
            justify-content: space-between;
            padding: 0.15cm 0;
            border-bottom: 1px dotted #bdc3c7;
            font-size: 8pt;
        }
        
        .conto-nome {
            font-weight: 600;
        }
        
        .conto-importo {
            font-family: 'Courier New', monospace;
            font-weight: 700;
        }
        
        .totale-row {
            display: flex;
            justify-content: space-between;
            padding: 0.3cm 0 0 0;
            margin-top: 0.3cm;
            border-top: 2px solid #34495e;
            font-weight: 700;
            font-size: 10pt;
        }
        
        .firme-container {
            margin-top: 1.2cm;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1cm;
        }
        
        .firma-box {
            text-align: center;
        }
        
        .firma-title {
            font-size: 10pt;
            font-weight: 700;
            color: #2c3e50;
            text-transform: uppercase;
            margin-bottom: 0.3cm;
        }
        
        .firma-ls {
            font-size: 9pt;
            color: #7f8c8d;
            font-style: italic;
            margin: 0.2cm 0;
        }
        
        .firma-spazio {
            min-height: 2.5cm;
            border-bottom: 1px solid #2c3e50;
            margin: 0.3cm 0;
            position: relative;
        }
        
        .firma-digitale {
            max-width: 4cm;
            height: auto;
            display: block;
            margin: 0 auto;
        }
        
        .timbro {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            max-width: 2.5cm;
            opacity: 0.7;
        }
        
        .firma-nome {
            font-size: 9pt;
            font-weight: 600;
            margin-top: 0.2cm;
        }
        
        .firma-data {
            font-size: 8pt;
            color: #7f8c8d;
            margin-top: 0.1cm;
        }
        
        .footer {
            margin-top: 0.8cm;
            padding-top: 0.3cm;
            border-top: 1px solid #bdc3c7;
            text-align: center;
            font-size: 7pt;
            color: #95a5a6;
        }
    </style>
</head>
<body>

    <!-- ============================================ -->
    <!-- PAGINA 1 - FRONTESPIZIO -->
    <!-- ============================================ -->
    <div class="page-frontespizio">
        
        <div class="header-diocesi">
            <h1>Diocesi di Caltagirone</h1>
            <h2>Rendiconto della Parrocchia</h2>
        </div>
        
        <div class="anno-box">
            ANNO {{ periodo_inizio[:4] }}
        </div>
        
        <div class="info-section">
            <h3>Parrocchia</h3>
            <div class="info-grid">
                <div class="info-row">
                    <span class="info-label">Denominazione:</span>
                    <span class="info-value">{{ ente.denominazione }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Codice Fiscale:</span>
                    <span class="info-value">{{ ente.codice_fiscale or '...........................' }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Indirizzo:</span>
                    <span class="info-value">{{ ente.indirizzo }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Comune:</span>
                    <span class="info-value">{{ ente.comune }} ({{ ente.provincia }})</span>
                </div>
                <div class="info-row">
                    <span class="info-label">CAP:</span>
                    <span class="info-value">{{ ente.cap }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Telefono:</span>
                    <span class="info-value">{{ ente.telefono or '...........................' }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Email:</span>
                    <span class="info-value">{{ ente.email or '...........................' }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Abitanti N.:</span>
                    <span class="info-value">{{ ente.numero_abitanti or '...........................' }}</span>
                </div>
            </div>
        </div>
        
        <div class="info-section">
            <h3>Parroco</h3>
            <div class="info-grid">
                <div class="info-row">
                    <span class="info-label">Cognome e Nome:</span>
                    <span class="info-value">{{ parroco_nome or '...........................' }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Nominato il:</span>
                    <span class="info-value">.............................</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Possesso canonico il:</span>
                    <span class="info-value">.............................</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Codice Fiscale:</span>
                    <span class="info-value">.............................</span>
                </div>
            </div>
        </div>
        
        <div class="nota-box">
            <strong>N.B.</strong> Questo rendiconto a norma del Can. 1284 § 2 n° 8 e 1287 § 1 e della CEI, "Istruzione in materia amministrativa" (2005), compilato in ogni sua parte e debitamente firmato dal Parroco, va presentato entro il 31 marzo dell'anno successivo all'Economato Diocesano.
        </div>
        
    </div>

    <!-- ============================================ -->
    <!-- PAGINE MOVIMENTI -->
    <!-- ============================================ -->
    <div class="page-movimenti">
        
        <h2>Dettaglio Movimenti Contabili - Anno {{ periodo_inizio[:4] }}</h2>
        
        <table>
            <thead>
                <tr>
                    <th class="td-data">Data</th>
                    <th>Causale</th>
                    <th>Conto</th>
                    <th class="td-importo">Entrate</th>
                    <th class="td-importo">Uscite</th>
                </tr>
            </thead>
            <tbody>
                {% for mov in movimenti %}
                <tr>
                    <td class="td-data">{{ mov.data }}</td>
                    <td>{{ mov.causale[:50] }}</td>
                    <td>{{ mov.conto }}</td>
                    <td class="td-importo entrata">
                        {% if mov.tipo == 'entrata' %}€ {{ "%.2f"|format(mov.importo) }}{% endif %}
                    </td>
                    <td class="td-importo uscita">
                        {% if mov.tipo == 'uscita' %}€ {{ "%.2f"|format(mov.importo) }}{% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
    </div>

    <!-- ============================================ -->
    <!-- ULTIMA PAGINA - RIEPILOGO -->
    <!-- ============================================ -->
    <div class="page-riepilogo">
        
        <div class="riepilogo-header">
            Riepilogo al 31 Dicembre {{ periodo_fine[:4] }}
        </div>
        
        <div class="riepilogo-orizzontale">
            <div class="riepilogo-box entrate">
                <div class="riepilogo-label">Totale Entrate</div>
                <div class="riepilogo-value entrata">€ {{ "%.2f"|format(totale_entrate) }}</div>
            </div>
            <div class="riepilogo-box uscite">
                <div class="riepilogo-label">Totale Uscite</div>
                <div class="riepilogo-value uscita">€ {{ "%.2f"|format(totale_uscite) }}</div>
            </div>
            <div class="riepilogo-box saldo">
                <div class="riepilogo-label">Differenza Attiva</div>
                <div class="riepilogo-value">€ {{ "%.2f"|format(saldo) }}</div>
            </div>
        </div>
        
        <div class="situazione-title">Situazione Patrimoniale al 31 Dicembre {{ periodo_fine[:4] }}</div>
        
        <div class="situazione-grid">
            <div class="situazione-col">
                <div class="col-title">Disponibilità</div>
                {% for conto in conti %}
                <div class="conto-row">
                    <span class="conto-nome">{{ conto.nome }}</span>
                    <span class="conto-importo">€ {{ "%.2f"|format(conto.saldo) }}</span>
                </div>
                {% endfor %}
                <div class="totale-row">
                    <span>TOTALE ATTIVO</span>
                    <span>€ {{ "%.2f"|format(totale_attivo) }}</span>
                </div>
            </div>
            
            <div class="situazione-col">
                <div class="col-title">Debiti</div>
                <div class="conto-row">
                    <span class="conto-nome">Fornitori</span>
                    <span class="conto-importo">€ 0,00</span>
                </div>
                <div class="conto-row">
                    <span class="conto-nome">Diocesi</span>
                    <span class="conto-importo">€ 0,00</span>
                </div>
                <div class="totale-row">
                    <span>TOTALE PASSIVO</span>
                    <span>€ 0,00</span>
                </div>
            </div>
        </div>
        
        {% if approvato %}
        <div style="margin: 0.6cm 0; padding: 0.4cm; background: #d4edda; border: 2px solid #27ae60; text-align: center; font-weight: 700;">
            ✓ RENDICONTO APPROVATO
        </div>
        {% endif %}
        
        <div class="firme-container">
            <div class="firma-box">
                <div class="firma-title">Il Parroco</div>
                <div class="firma-spazio"></div>
                <div class="firma-nome">{{ parroco_nome }}</div>
                <div class="firma-data">{{ data_compilazione }}</div>
            </div>
            
            <div class="firma-box">
                <div class="firma-title">L'Ordinario Diocesano</div>
                <div class="firma-ls">(L.S.)</div>
                <div class="firma-spazio">
                    {% if approvato %}
                    <img src="file://{{ firma_vescovo_path }}" class="firma-digitale" alt="Firma">
                    {% if timbro_path %}
                    <img src="file://{{ timbro_path }}" class="timbro" alt="Timbro">
                    {% endif %}
                    {% endif %}
                </div>
                <div class="firma-nome">S.E. Mons. Calogero Peri</div>
                {% if approvato %}
                <div class="firma-data">Caltagirone, {{ data_compilazione }}</div>
                {% else %}
                <div class="firma-data">(Dopo approvazione)</div>
                {% endif %}
            </div>
        </div>
        
        <div class="footer">
            Sistema Gestionale Diocesi di Caltagirone | {{ data_compilazione }}
            {% if approvato %}<br><strong>DOCUMENTO APPROVATO E FIRMATO DIGITALMENTE</strong>{% endif %}
        </div>
    </div>

</body>
</html>